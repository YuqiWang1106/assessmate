{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% if readonly %}View{% else %}Create{% endif %} Assessment</title>
    <script src="{% static 'js/create_assessment.js' %}"></script>

    <script>
        var READ_ONLY = "{{ readonly|yesno:'true,false' }}";
    </script>
    
    
</head>
<body>

    <h1>{% if readonly %}View{% else %}Create{% endif %} Assessment</h1>

    <!-- Add Question Button -->
    {% if not readonly %}
    <button onclick="openModal()">Add Question</button>
    {% endif %}

    <!-- Question List Area -->
    <form id="assessment-form" method="POST">
        {% csrf_token %}

        <!-- Assessment Title -->
        <label for="assessment-title">Assessment Title:</label>
        <input
            type="text"
            id="assessment-title"
            name="assessment_title"
            placeholder="Enter assessment title"
            style="width: 60%;"
            value="{{ assessment.title|default_if_none:'' }}"
            {% if readonly %}disabled{% endif %}
        />
        <br><br>

        <div id="question-list">
        <!-- Questions will be inserted here -->
        </div>

        <!-- Control Buttons -->
        <br>
        {% if readonly %}
            <button type="button" onclick="quitWithoutSaving()">Quit</button>
        {% else %}
            <button type="button" onclick="openQuitModal()">Quit</button>
            <button type="button" onclick="openPublishModal()">Publish</button>
        {% endif %}
    </form>

    <!-- Delete Assessment Button (always shown if editing) -->
    {% if assessment %}
        <input type="hidden" id="assessment-id" value="{{ assessment.id }}">
        <button type="button" onclick="openDeleteModal()">Delete Assessment</button>
    {% endif %}

    <input type="hidden" id="teacher-id" value="{{ teacher.id }}">

    <!-- Question Type Modal -->
    <div id="question-modal" style="display: none; position: fixed; top: 20%; left: 30%; background: white; border: 1px solid #ccc; padding: 20px;">
        <h3>Select Question Type</h3>
        <select id="question-type">
            <option value="likert">Likert Scale</option>
            <option value="open">Open-Ended</option>
        </select>
        <br><br>
        <button onclick="confirmAddQuestion()">Confirm</button>
        <button onclick="closeModal()">Cancel</button>
    </div>

    <!-- Publish Modal -->
    <div id="publish-modal" style="display: none; position: fixed; top: 25%; left: 30%; background: white; border: 1px solid #ccc; padding: 20px;">
        <h3>Select Due Date</h3>
        <input type="date" id="due-date" />
        <br><br>
        <button onclick="confirmPublish()">OK</button>
        <button onclick="closePublishModal()">Cancel</button>
    </div>

    <!-- Quit Confirmation Modal -->
    <div id="quit-modal" style="display: none; position: fixed; top: 30%; left: 30%; background: white; border: 1px solid #ccc; padding: 20px;">
        <h3>Are you sure you want to quit?</h3>
        <p>You can save your changes or discard them.</p>
        <button onclick="confirmQuitAndSave()">Save & Quit</button>
        <button onclick="quitWithoutSaving()">Quit Anyway</button>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" style="display: none; position: fixed; top: 35%; left: 30%; background: white; border: 1px solid #ccc; padding: 20px;">
        <h3>Are you sure you want to delete this assessment?</h3>
        <p>This action cannot be undone.</p>
        <button onclick="confirmDelete()">Yes, Delete</button>
        <button onclick="closeDeleteModal()">Cancel</button>
    </div>

    <!-- Preloaded Questions JSON -->
    <script id="preloaded-questions" type="application/json">
        {{ questions_json|safe }}
    </script>

</body>
</html>
